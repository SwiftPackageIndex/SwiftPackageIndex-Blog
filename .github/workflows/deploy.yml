name: Deploy Site

on:
  push:
    branches: [master]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - uses: fwal/setup-swift@v1
        with:
          swift-version: '5.4'
      - name: Write Deploy Key
        run: |
          echo "$ACTIONS_DEPLOY_KEY" > ~/.ssh/id_rsa
          chmod 0600 ~/.ssh/id_rsa
        env:
          ACTIONS_DEPLOY_KEY: ${{ secrets.ACTIONS_DEPLOY_KEY }}
      - name: Build Publish
        run: |
          git clone https://github.com/JohnSundell/Publish.git
          cd Publish
          make
      - name: Generate Static Site
        run: make deploy
        env:
          PUBLISH_ENV: production
